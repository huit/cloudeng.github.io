
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>Cloud Eng: </title>
   <meta name="author" content="HUIT Cloud Engineering" />
   <link href="http://feeds.feedburner.com/" rel="alternate" title="your title" type="application/atom+xml" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/assets/themes/tom/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/assets/themes/tom/css/screen.css" type="text/css" media="screen, projection" />

   <!-- Typekit -->
   <script type="text/javascript" src="http://use.typekit.com/jpd0pfm.js"></script>
   <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body>

  <div class="site">
    <div class="title">
      <a href="/">HUIT Cloud Engineering</a>

      <a class="extra" href="/archive.html">Archive</a>
      <a class="extra" href="">Pages</a>
      <a class="extra" href="/categories.html">Categories</a>
      <a class="extra" href="/tags.html">Tags</a>
      <a class="extra" href="/about.html">About</a>
      <a class="extra" href="/projects.html">Projects</a>
      <!---  <a class="extra" href="/the-big-board.html">The Big Board</a> --->
    </div>
  
    
<div id="post">
<p></br>
<div class="blog-index">  </p>

<h1 class="entry-title">

    <a href="/index.html">Cloud Eng: </a>
    
    
    <a href="/2013/10/21/how-i-made-this-blog.html">How I made this Blog</a>

</h1>

<div class="entry-content"><h2 id="toc_0">How I made this Blog - A Drama in Many Parts.</h2>

<p><a href="#The%20Quick%20and%20Dirty">The Quick and Dirty</a>
 <a href="#Install%20s3_website">Install s3_website</a></p>

<p>This post may get a little long and ramble a bit, so let me skip directly to the payoff - quick and easy content managment on crazy robust and reliable infrastructure. Here&#39;s the commands I need to add and post new content:</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"> <span class="o">]</span><span class="nv">$ </span>vim _posts/2013-09-27-hello-world.md 

 <span class="o">]</span><span class="nv">$ </span>jekyll serve 

<span class="o">]</span><span class="nv">$ </span>s3_website push
</code></pre></div>
<p>and Behold - The power of S3 and CloudFront!  </p>

<h1 id="toc_1"></h1>

<h3 id="toc_2">The Quick and Dirty</h3>

<ol>
<li>Make sure you have a new-ish version of ruby, if not, install <a href="https://github.com/sstephenson/rbenv#homebrew-on-mac-os-x">rbenv</a></li>
<li>Install or configure Jekyll ( I used Jekyll bootstrap to start with since I&#39;m new to it )</li>
<li>Install <a href="https://github.com/laurilehmijoki/s3_website">s3_website</a></li>
<li>Configure <em>config.yml and s3</em>website.yml</li>
<li>Create Your first post under _posts</li>
<li>Check to see if your site works locally by running -  jekyll serve</li>
<li>Create your AWS <strong>Stuff</strong>                          - s3_website cfg apply</li>
<li>Point a CNAME at your CloudFront bucket</li>
<li>Publish your Site to your s3 bucket                - s3_website push</li>
<li>Repeat steps 5,6 and 9 for fun and profit!</li>
</ol>

<h1 id="toc_3"></h1>

<h3 id="toc_4">Install s3_website</h3>

<p>on my shiny new Mac, I wasn&#39;t able to install s3_website due to failed dependency</p>

<p><a href="https://github.com/laurilehmijoki/s3_website">https://github.com/laurilehmijoki/s3_website</a></p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">alaric@dhcp-128-103-209-223 splunk-searches<span class="o">]</span><span class="nv">$ </span>gem install -b s3_website
ERROR:  While executing gem ... <span class="o">(</span>Gem::FilePermissionError<span class="o">)</span>
    You don<span class="err">&#39;</span>t have write permissions into the /Library/Ruby/Gems/1.8 directory.
<span class="o">[</span>alaric@dhcp-128-103-209-223 splunk-searches<span class="o">]</span><span class="nv">$ </span>sudo gem install -b s3_website
Password:
ERROR:  Error installing s3_website:
  nokogiri requires Ruby version &gt;<span class="o">=</span> 1.9.2.
</code></pre></div>
<p>However thanks to brew I was able to use a newer version of Ruby and get it installed!</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">brew install ruby


<span class="o">[</span>alaric@preator ~<span class="o">]</span><span class="nv">$ </span>sudo gem install -b s3_website
Password:
</code></pre></div>
<p>After proving that I know nothing about Ruby paths.. @hakamadare turned me on to <a href="https://github.com/sstephenson/rbenv#homebrew-on-mac-os-x">rbenv</a></p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="o">[</span>alaric@vpn-209-21 ~<span class="o">]</span><span class="nv">$ </span>brew install <span class="nv">rbenv</span>
<span class="o">==</span>&gt; Downloading https://github.com/sstephenson/rbenv/archive/v0.4.0.tar.gz
<span class="c">######################################################################## 100.0%</span>
<span class="o">==</span>&gt; Caveats
To use Homebrew<span class="err">&#39;</span>s directories rather than ~/.rbenv add to your profile:
  <span class="nb">export </span><span class="nv">RBENV_ROOT</span><span class="o">=</span>/usr/local/var/rbenv

To <span class="nb">enable </span>shims and autocompletion add to your profile:
  <span class="k">if </span>which rbenv &gt; /dev/null; <span class="k">then </span><span class="nb">eval</span> <span class="s2">&quot;$(rbenv init -)&quot;</span>; <span class="k">fi</span>
<span class="o">==</span>&gt; Summary
üç∫  /usr/local/Cellar/rbenv/0.4.0: 31 files, 152K, built in 2 seconds
<span class="o">[</span>alaric@vpn-209-21 ~<span class="o">]</span><span class="nv">$ </span>brew install ruby-build
<span class="o">==</span>&gt; Installing dependencies <span class="k">for </span>ruby-build: <span class="nv">autoconf</span>
<span class="o">==</span>&gt; Installing ruby-build dependency: <span class="nv">autoconf</span>
<span class="o">==</span>&gt; Downloading http://ftpmirror.gnu.org/autoconf/autoconf-2.69.tar.gz
<span class="c">######################################################################## 100.0%</span>
<span class="o">==</span>&gt; ./configure --prefix<span class="o">=</span>/usr/local/Cellar/autoconf/2.69
<span class="o">==</span>&gt; make install
üç∫  /usr/local/Cellar/autoconf/2.69: 69 files, 2.0M, built in 22 <span class="nv">seconds</span>
<span class="o">==</span>&gt; Installing ruby-build
<span class="o">==</span>&gt; Downloading https://github.com/sstephenson/ruby-build/archive/v20130923.tar.gz
<span class="c">######################################################################## 100.0%</span>
<span class="o">==</span>&gt; ./install.sh
üç∫  /usr/local/Cellar/ruby-build/20130923: 84 files, 372K, built in 2 seconds
</code></pre></div>
<p>And in my case, I had to source my .bash_profile again after switching ruby versions with rbenv, (So for those keeping score, three (ahhahah) versions of ruby now)  to get the gem to show up in my path (two versions of s3_website..)</p>

<p>source .bash_profile</p>

<p>AWS Creds</p>

<p>Since we are all agile and stuff, multiple people will be updating the blog - so I didn&#39;t want to put AWS credentials into the repo itself.. plus we <em>are</em> publishing them on github, so I thought i&#39;d source them from ENV variables as per the instructions on the s3_website docs... but I source in my AWS Creds this way in my bash_profile file</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="nb">export </span><span class="nv">AWS_CONFIG_FILE</span><span class="o">=</span>~/aws_creds.txt 
</code></pre></div>
<p>AND! --- FAIL! </p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">alaric@preator cloudeng.github.io<span class="o">]</span><span class="nv">$ </span>s3_website cfg apply
Applying the configurations in s3_website.yml on the AWS services ...
/Users/alaric/.rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/configure-s3-website-1.4.0/lib/configure-s3-website/http_helper.rb:62:in <span class="sb">`</span>digest<span class="s1">&#39;: no implicit conversion of nil into String (TypeError)</span>
<span class="s1">from /Users/alaric/.rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/configure-s3-website-1.4.0/lib/configure-s3-website/http_helper.rb:62:in `create_s3_digest&#39;</span>
from /Users/alaric/.rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/configure-s3-website-1.4.0/lib/configure-s3-website/http_helper.rb:6:in <span class="sb">`</span>call_s3_api<span class="s1">&#39;</span>
<span class="s1">from /Users/alaric/.rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/configure-s3-website-1.4.0/lib/configure-s3-website/s3_client.rb:34:in `enable_website_configuration&#39;</span>
from /Users/alaric/.rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/configure-s3-website-1.4.0/lib/configure-s3-website/s3_client.rb:12:in <span class="sb">`</span>configure_website<span class="s1">&#39;</span>
<span class="s1">from /Users/alaric/.rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/configure-s3-website-1.4.0/lib/configure-s3-website/runner.rb:4:in `run&#39;</span>
from /Users/alaric/.rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/configure-s3-website-1.4.0/bin/configure-s3-website:12:in <span class="sb">`</span>&lt;top <span class="o">(</span>required<span class="o">)</span>&gt;<span class="s1">&#39;</span>
<span class="s1">from /Users/alaric/.rbenv/versions/2.0.0-p247/bin/configure-s3-website:23:in `load&#39;</span>
from /Users/alaric/.rbenv/versions/2.0.0-p247/bin/configure-s3-website:23:in <span class="sb">`</span>&lt;main&gt;<span class="err">&#39;</span>
<span class="o">[</span>alaric@preator cloudeng.github.io<span class="o">]</span><span class="nv">$ </span>
</code></pre></div>
<p>But thats ok, it&#39;s a quick hack! </p>

<p>EPIC FAIL AGAIN!!! </p>

<p>Why? Because sometime I assume I&#39;m smarting then the instructions.... and am mostly wrong. the envirment variables they want you to use are</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="nb">export </span><span class="nv">S3_ID</span><span class="o">=</span>&lt;ID&gt;
<span class="nb">export </span><span class="nv">S3_SECRET</span><span class="o">=</span>&lt;SECRET&gt;
</code></pre></div>
<p>NOT aws_access_key_id, and aws_secret_access_key which I, having read the AWS docs (ok, skimmed) tried first! </p>

<p>=== AND THEN! ===</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="o">[</span>alaric@preator cloudeng.github.io<span class="o">]</span><span class="nv">$ </span>s3_website cfg apply
Applying the configurations in s3_website.yml on the AWS services ...
Created bucket cloudhacks.huit.harvard.edu in the US Standard Region
Bucket cloudhacks.huit.harvard.edu now functions as a website
Bucket cloudhacks.huit.harvard.edu is now readable to the whole world
No redirects to configure <span class="k">for </span>cloudhacks.huit.harvard.edu bucket
Do you want to deliver your website via CloudFront, the CDN of Amazon? <span class="o">[</span>y/N<span class="o">]</span> n
</code></pre></div>
<p>and BAM!! a freaking awesome bucket! </p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">alaric@preator cloudeng.github.io<span class="o">]</span><span class="nv">$ </span>s3_website push
Deploying _site/* to cloudhacks.huit.harvard.edu
Calculating diff ... <span class="k">done</span>
Uploading 19 new file<span class="o">(</span>s<span class="o">)</span>
Upload archive.html: Success!
Upload 404.html: Success!
Upload 2013/09/27/hello-world/index.html: Success!
Upload assets/themes/tom/css/screen.css: Success!
Upload assets/themes/tom/images/rss.png: Success!
Upload assets/themes/tom/css/syntax.css: Success!
Upload assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css: Success!
Upload assets/themes/twitter/bootstrap/img/glyphicons-halflings-white.png: Success!
Upload assets/themes/twitter/bootstrap/img/glyphicons-halflings.png: Success!
Upload categories.html: Success!
Upload atom.xml: Success!
Upload assets/themes/twitter/css/style.css: Success!
Upload Genfile: Success!
Upload index.html: Success!
Upload History.markdown: Success!
Upload pages.html: Success!
Upload rss.xml: Success!
Upload sitemap.txt: Success!
Upload tags.html: Success!
Done! Go visit: http://cloudhacks.huit.harvard.edu.s3-website-us-east-1.amazonaws.com/index.html
</code></pre></div>
<p>OK - that was pretty sweet... but I can totall do that on my own... it&#39;s just s3 right??  Lets CDN this bad larry! - So I&#39;ll run s3_website cfg apply again and see what happens!! </p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="o">[</span>alaric@preator cloudeng.github.io<span class="o">]</span><span class="nv">$ </span>s3_website cfg apply
Applying the configurations in s3_website.yml on the AWS services ...
Bucket cloudhacks.huit.harvard.edu now functions as a website
Bucket cloudhacks.huit.harvard.edu is now readable to the whole world
No redirects to configure <span class="k">for </span>cloudhacks.huit.harvard.edu bucket
Do you want to deliver your website via CloudFront, the CDN of Amazon? <span class="o">[</span>y/N<span class="o">]</span>
y
  The distribution E2KIUNT4276WHO at d99xfp4zz9wie.cloudfront.net now delivers the bucket cloudhacks.huit.harvard.edu
    Please allow up to 15 minutes <span class="k">for </span>the distribution to initialise
    For more information on the distribution, see https://console.aws.amazon.com/cloudfront
  Added setting <span class="s1">&#39;cloudfront_distribution_id: E2KIUNT4276WHO&#39;</span> into s3_website.yml
<span class="o">[</span>alaric@preator cloudeng.github.io<span class="o">]</span><span class="nv">$ </span><span class="nb">jobs</span>
<span class="o">[</span>1<span class="o">]</span>+  Stopped                 vim _config.yml
<span class="o">[</span>2<span class="o">]</span>-  Stopped                 vim s3_website.yml
<span class="o">[</span>alaric@preator cloudeng.github.io<span class="o">]</span><span class="nv">$ </span><span class="nb">fg </span>2
vim s3_website.yml
</code></pre></div>
<p>Now I have d99xfp4zz9wie.cloudfront.net as a target for our awesome blog! I was totally ready for my sweet sweet vicotry! </p>

<p>So All I needed to do now was to create the CNAME in DNS with our DNS Admin tool! Click-Click Click... and </p>

<p>BAAA-- wait... --- no BAM??!</p>

<p>I get this??!!</p>

<hr>

<h2 id="toc_5">ERROR</h2>

<p>The request could not be satisfied.
Generated by cloudfront (CloudFront)</p>

<hr>

<p>OK- Back to reading the <a href="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/CNAMEs.html">AWS CloudFront Docs</a> and apprently I need to add an alternate domain name to the CloudFront Config, Luckly s3_website lets me do that with just a bit of editing to the config file! </p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">cloudfront_distribution_config</span><span class="p-Indicator">:</span>
   <span class="l-Scalar-Plain">aliases</span><span class="p-Indicator">:</span>
     <span class="l-Scalar-Plain">quantity</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
     <span class="l-Scalar-Plain">items</span><span class="p-Indicator">:</span>
       <span class="l-Scalar-Plain">CNAME</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">cloudhacks.huit.harvard.edu</span>
</code></pre></div>
<p>After updating the config, I gave s3_website another spin - </p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">alaric@preator cloudeng.github.io<span class="o">]</span><span class="nv">$ </span>s3_website cfg apply
Applying the configurations in s3_website.yml on the AWS services ...
Bucket cloudhacks.huit.harvard.edu now functions as a website
Bucket cloudhacks.huit.harvard.edu is now readable to the whole world
No redirects to configure <span class="k">for </span>cloudhacks.huit.harvard.edu bucket
Detected an existing CloudFront distribution <span class="o">(</span>id E2KIUNT4276WHO<span class="o">)</span> ...
  Applied custom distribution settings:
    aliases:
      quantity: 1
      items:
        CNAME: cloudhacks.huit.harvard.edu
</code></pre></div>
<p>In the AWS Console, I can see my new Domain added, and the distribution is listed as &quot;In Progress&quot; </p>

<p>And with that - after waiting about 10 minutes for the content to update, I got my much anticipated &quot;BAM!&quot; and vicotry dance! Welcome to the <a href="http://cloudhacks.huit.harvard.edu/">Cloud Hacks blog!</a> </p>

<p>To Push Posts we just use the s3_website push command!</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">Deploying _site/* to cloudhacks.huit.harvard.edu
Calculating diff ... <span class="k">done</span>
No new or changed files to upload
Done! Go visit: http://cloudhacks.huit.harvard.edu.s3-website-us-east-1.amazonaws.com/index.html
Invalidating Cloudfront items...
  /
succeeded
</code></pre></div>
<p>After All that, I thought I was golden, however I couldn&#39;t for the life of me get links working! </p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="c"># This is the default format. </span>
<span class="c"># For more see: http://jekyllrb.com/docs/permalinks/</span>
<span class="c">#permalink: /:categories/:year/:month/:day/:title </span>
</code></pre></div>
<p>The End</p>
</div>

<p></div></p>

<ul class="posts">
  
    <li><span>21 Oct 2013</span> &raquo; <a href="/2013/10/21/how-i-made-this-blog.html">How I made this Blog</a></li>
  
    <li><span>27 Sep 2013</span> &raquo; <a href="/2013/09/27/hello-world.html">Hello World</a></li>
  
</ul>

</div>


  
    <div class="footer">
      <div class="contact">
        <p>
          HUIT Cloud Engineering<br />
          Boldly Falling down the Nepho-Net<br />
          <a href='mailto:nephoeng@harvard.edu'>nephoeng@harvard.edu</a>
        </p>
      </div>
      <div class="contact">
        <p>
          <a href="http://github.com/huit/">github.com/huit</a><br />
          <a href="http://twitter.com/nephoeng/">twitter.com/nephoeng</a><br />
        </p>
      </div>
      <div class="rss">
        <a href="http://feeds.feedburner.com/">
          <img src="/assets/themes/tom/images/rss.png" alt="Subscribe to RSS Feed" />
        </a>
      </div>
    </div>
  </div>
  <a href="http://github.com/huit"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>

  
</body>
</html>

